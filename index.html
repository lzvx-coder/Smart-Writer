<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å†™ä½œä¸æ‰¹æ”¹åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg);
            }
            to { transform: rotate(360deg);
            }
        }
        .score-bar {
            transition: width 0.5s ease;
        }
        .tab-active {
            border-bottom: 3px solid #4f46e5;
            color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen p-4">
    <div id="app" class="max-w-7xl mx-auto">
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                âœ¨ æ™ºèƒ½å†™ä½œä¸æ‰¹æ”¹åŠ©æ‰‹
            </h1>
            <p class="text-gray-600">å¤šè¯­è¨€æ¶¦è‰² Â· æ™ºèƒ½æ‰¹æ”¹ Â· å¤šç»´åº¦è¯„åˆ† Â· é£æ ¼ä¼˜åŒ–</p>
        </div>

        <div id="errorBox" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"></div>

        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="flex gap-4 border-b">
                <button onclick="switchMode('translate')" id="tab-translate" 
 class="px-4 py-2 font-semibold tab-active">
                    ğŸŒ å¤šè¯­è¨€æ¶¦è‰²
                </button>
                <button onclick="switchMode('critique')" id="tab-critique" class="px-4 py-2 font-semibold text-gray-600">
                    ğŸ“ æ™ºèƒ½æ‰¹æ”¹
                </button>
 
                <button onclick="switchMode('enhance')" id="tab-enhance" class="px-4 py-2 font-semibold text-gray-600">
                    âœ¨ é£æ ¼ä¼˜åŒ–
                </button>
                <button onclick="switchMode('compare')" id="tab-compare" class="px-4 py-2 font-semibold text-gray-600">
                    
 ğŸ”„ ç‰ˆæœ¬å¯¹æ¯”
                </button>
            </div>
        </div>

        <div id="translateMode" class="space-y-6">
            <div class="bg-white rounded-lg shadow-md p-6">
           
           <h2 class="text-lg font-semibold text-gray-800 mb-4">é€‰æ‹©å†™ä½œé£æ ¼</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="styleButtons"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                  <div class="flex justify-between items-center mb-4">
    <h2 class="text-lg font-semibold text-gray-800">è¾“å…¥æ–‡æœ¬</h2>

    <div class="flex items-center gap-3">   

        <input type="file" id="uploadTranslate" class="hidden" accept=".docx,.doc,.txt" onchange="handleFileUpload(this, 'inputText')">
        <button onclick="document.getElementById('uploadTranslate').click()" 
                class="flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 px-2 py-1 rounded transition-colors"
                title="æ”¯æŒ Word (.docx) å’Œ TXT æ–‡ä»¶">
            ğŸ“‚ ä¸Šä¼ 
        </button>

        <span class="text-sm text-gray-500" id="inputCount">0 å­—</span>
    </div>
</div>
                    <textarea 
                        id="inputText"
                        placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘æˆ–æ”¹å†™çš„å†…å®¹..."
                    
                     class="w-full h-80 p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="flex gap-2 mt-4">
                    
                     <button 
                            onclick="generateContent()"
                            id="generateBtn"
                            class="flex-1 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
    
                         >
                            âœ¨ ç”Ÿæˆå†…å®¹
                        </button>
                        <button 
  
                           onclick="clearAll()"
                            class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                        >
                
             ğŸ—‘ï¸ æ¸…ç©º
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-800">è¾“å‡ºç»“æœ</h2>
                        <div class="flex gap-2 items-center">
          
                           <span class="text-sm text-gray-500" id="outputCount">0 å­—</span>
                            <button 
                                onclick="copyText()" 
                
                                 id="copyBtn"
                                class="p-2 hover:bg-gray-100 rounded-lg transition-colors hidden"
                                title="å¤åˆ¶"
                
                             >
                                ğŸ“‹
                            </button>
                            
                             <button 
                                onclick="downloadText()" 
                                id="downloadBtn"
                                class="p-2 hover:bg-gray-100 
 rounded-lg transition-colors hidden"
                                title="ä¸‹è½½"
                            >
                                ğŸ’¾
      
                           </button>
                        </div>
                    </div>
                    <div id="outputText" class="w-full h-80 p-4 border border-gray-300 rounded-lg overflow-y-auto bg-gray-50">
     
                        <p class="text-gray-400 italic">ç”Ÿæˆçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="critiqueMode" class="hidden space-y-6">
 
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                     
                   <h2 class="text-lg font-semibold text-gray-800">å¾…æ‰¹æ”¹æ–‡æœ¬</h2>
                        <span class="text-sm text-gray-500" id="critiqueInputCount">0 å­—</span>
                    </div>
                    <textarea 
                        id="critiqueInput"
 
                        placeholder="è¯·è¾“å…¥éœ€è¦æ‰¹æ”¹çš„æ–‡æœ¬ï¼ˆæ”¯æŒä¸­æ–‡æˆ–è‹±æ–‡ï¼‰..."
                        class="w-full h-96 p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        oninput="updateCritiqueCount()"
                    
 ></textarea>
                    <div class="flex gap-2 mt-4">
                        <select id="critiqueType" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <option value="academic">å­¦æœ¯è®ºæ–‡</option>
                  
                      <option value="business">å•†åŠ¡æ–‡æ¡£</option>
                            <option value="creative">åˆ›æ„å†™ä½œ</option>
                            <option value="technical">æŠ€æœ¯æ–‡æ¡£</option>
                            <option value="general">é€šç”¨æ–‡æœ¬</option>
  
                       </select>
                        <button 
                            onclick="critiqueText()"
                         
                   id="critiqueBtn"
                            class="flex-1 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                        >
                            ğŸ“ å¼€å§‹æ‰¹æ”¹
         
                 </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
          
                      <h2 class="text-lg font-semibold text-gray-800 mb-4">è¯„åˆ†é¢æ¿</h2>
                    <div id="scorePanel" class="space-y-4">
                        <p class="text-gray-400 text-sm">æ‰¹æ”¹å®Œæˆåå°†æ˜¾ç¤ºè¯„åˆ†</p>
                    </div>
                </div>
  
           </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">æ‰¹æ”¹è¯¦æƒ…</h2>
                <div id="critiqueResults" class="space-y-3">
                    <p 
 class="text-gray-400 italic">æ‰¹æ”¹ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                </div>
            </div>
        </div>

        <div id="enhanceMode" class="hidden space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
     
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">åŸæ–‡</h2>
                    <textarea 
                        id="enhanceInput"
                        placeholder="è¯·è¾“å…¥éœ€è¦ä¼˜åŒ–çš„æ–‡æœ¬..."
            
                         class="w-full h-96 p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-indigo-500"
                    ></textarea>
                    <div class="mt-4 space-y-2">
                        <label class="block text-sm font-medium text-gray-700">ä¼˜åŒ–æ–¹å‘</label>
          
                       <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="enhance-clarity" checked class="rounded">
                
                                 <span class="text-sm">æå‡æ¸…æ™°åº¦</span>
                            </label>
                            <label class="flex items-center gap-2">
                        
                                 <input type="checkbox" id="enhance-concise" checked class="rounded">
                                <span class="text-sm">ç®€æ´è¡¨è¾¾</span>
                            </label>
                           
                             <label class="flex items-center gap-2">
                                <input type="checkbox" id="enhance-professional" class="rounded">
                                <span class="text-sm">ä¸“ä¸šæ€§</span>
                            
                             </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="enhance-engaging" class="rounded">
                                <span class="text-sm">å¸å¼•åŠ›</span>
 
                            </label>
                        </div>
                        <button 
                        
                            onclick="enhanceText()"
                            id="enhanceBtn"
                            class="w-full mt-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                        >
        
                         âœ¨ å¼€å§‹ä¼˜åŒ–
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg 
 shadow-md p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">ä¼˜åŒ–å</h2>
                    <div id="enhanceOutput" class="w-full h-96 p-4 border border-gray-300 rounded-lg overflow-y-auto bg-gray-50">
                        <p class="text-gray-400 italic">ä¼˜åŒ–ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                    
 </div>
                    <button 
                        onclick="copyEnhanced()"
                        id="copyEnhancedBtn"
                        class="w-full mt-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 
 transition-colors hidden"
                    >
                        ğŸ“‹ å¤åˆ¶ä¼˜åŒ–åæ–‡æœ¬
                    </button>
                </div>
            </div>
      
       </div>

        <div id="compareMode" class="hidden space-y-6">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">ç‰ˆæœ¬å¯¹æ¯”</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    
                     <div>
                        <h3 class="text-sm font-medium text-gray-700 mb-2">ç‰ˆæœ¬ A</h3>
                        <textarea 
                            id="compareTextA"
                  
                           placeholder="è¾“å…¥ç‰ˆæœ¬A..."
                            class="w-full h-80 p-4 border border-gray-300 rounded-lg resize-none"
                        ></textarea>
                    </div>
            
                     <div>
                        <h3 class="text-sm font-medium text-gray-700 mb-2">ç‰ˆæœ¬ B</h3>
                        <textarea 
                            id="compareTextB"
          
                             placeholder="è¾“å…¥ç‰ˆæœ¬B..."
                            class="w-full h-80 p-4 border border-gray-300 rounded-lg resize-none"
                        ></textarea>
                    </div>
    
                 </div>
                <button 
                    onclick="compareVersions()"
                    id="compareBtn"
                    class="w-full mt-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
   
                  >
                    ğŸ”„ æ™ºèƒ½å¯¹æ¯”
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">å¯¹æ¯”ç»“æœ</h2>
  
                   <div id="compareResults" class="prose max-w-none">
                    <p class="text-gray-400 italic">å¯¹æ¯”ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                </div>
            </div>
        </div>

        <div id="historySection" class="hidden bg-white rounded-lg shadow-md p-6 
 mt-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-800">ğŸ“œ å†å²è®°å½•</h2>
                <button onclick="clearHistory()" class="text-sm text-red-600 hover:text-red-700">æ¸…ç©ºå†å²</button>
            </div>
            <div id="historyList" class="space-y-3"></div>
        </div>

        <div class="text-center mt-8 text-sm text-gray-500">
            <p>ğŸ’¡ æç¤ºï¼šåˆ‡æ¢é£æ ¼ä¼šè‡ªåŠ¨é‡æ–°ç”Ÿæˆå†…å®¹ Â· å†å²è®°å½•ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ Â· åŸºäºå¤§æ¨¡å‹æŠ€æœ¯</p>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ”‘ åœ¨è¿™é‡Œå¡«å†™ä½ çš„API Key
        // ==========================================
        const API_KEY = 'ljhlovezx';
 // â¬…ï¸ åœ¨è¿™é‡Œæ›¿æ¢æˆä½ çš„API Key
        const API_MODEL = 'glm-4-plus';
 // å¯é€‰ï¼šglm-4-plus, glm-4, glm-4-air, glm-4-flash
        // ==========================================

        let selectedStyle = 'academic';
 let currentMode = 'translate';
        let historyData = [];

        const styles = [
            { id: 'academic', name: 'å­¦æœ¯è®ºæ–‡', icon: 'ğŸ“š', temp: 0.3, desc: 'ä¸¥è°¨ä¸“ä¸šï¼Œæœ¯è¯­ä¸°å¯Œ' },
            { id: 'business', name: 'å•†åŠ¡é‚®ä»¶', icon: 'ğŸ’¼', temp: 0.4, desc: 'ç¤¼è²Œæ­£å¼ï¼Œç®€æ´æ˜äº†' },
            { id: 'social', name: 'ç¤¾äº¤åª’ä½“', icon: 'ğŸ’¬', temp: 0.8, desc: 'è½»æ¾æœ‰è¶£ï¼Œæ˜“äºä¼ æ’­' },
            { id: 'technical', name: 'æŠ€æœ¯æ–‡æ¡£', icon: 'ğŸ’»', temp: 
 0.3, desc: 'ç²¾ç¡®ç»“æ„åŒ–ï¼Œé€»è¾‘æ¸…æ™°' }
        ];
const stylePrompts = {
    academic: `
ä½ æ˜¯ä¸€ä½èµ„æ·±å­¦æœ¯å†™ä½œä¸“å®¶ã€‚è¯·åœ¨ä¿æŒè¾“å…¥æ–‡æœ¬åŸæœ¬è¯­è¨€çš„å‰æä¸‹ï¼ˆè¾“å…¥ä»€ä¹ˆè¯­è¨€ï¼Œå°±ç”¨ä»€ä¹ˆè¯­è¨€è¾“å‡ºï¼‰ï¼Œå°†å…¶è½¬æ¢ä¸ºæ›´ç¬¦åˆå­¦æœ¯è®ºæ–‡é£æ ¼çš„ç‰ˆæœ¬ã€‚è¦æ±‚ï¼š
- ä½¿ç”¨ä¸“ä¸šæœ¯è¯­ï¼Œè¡¨è¾¾ä¸¥è°¨ï¼›
- é€»è¾‘ç»“æ„æ¸…æ™°ï¼Œç¬¦åˆå­¦æœ¯å†™ä½œè§„èŒƒï¼›
- é€‚å½“æå‡è¯­è¨€è´¨é‡ï¼Œä½†ä¸æ”¹å˜åŸæ„ã€‚
    `,

    business: `
ä½ æ˜¯ä¸€ä½ä¸“ä¸šå•†åŠ¡æ²Ÿé€šé¡¾é—®ã€‚è¯·åœ¨ä¿æŒè¾“å…¥æ–‡æœ¬è¯­è¨€ä¸å˜ï¼ˆè¾“å…¥ä»€ä¹ˆè¯­è¨€ï¼Œå°±ç”¨ä»€ä¹ˆè¯­è¨€è¾“å‡ºï¼‰çš„å‰æä¸‹ï¼Œå°†å…¶æ”¹å†™ä¸ºæ­£å¼å•†åŠ¡é‚®ä»¶é£æ ¼ã€‚è¦æ±‚ï¼š
- ç¤¼è²Œã€æ¸…æ™°ã€ä¸“ä¸šï¼›
- çªå‡ºé‡ç‚¹ï¼Œè¡¨è¾¾ç®€æ´ï¼›
- ä¿ç•™åŸæ„å¹¶æå‡å¯è¯»æ€§ã€‚
    `,

    social: `
ä½ æ˜¯ä¸€ä½ç¤¾äº¤åª’ä½“å†…å®¹åˆ›ä½œä¸“å®¶ã€‚è¯·åœ¨ä¿æŒè¾“å…¥è¯­è¨€ä¸å˜ï¼ˆè¾“å…¥ä»€ä¹ˆè¯­è¨€ï¼Œå°±ç”¨ä»€ä¹ˆè¯­è¨€è¾“å‡ºï¼‰çš„æƒ…å†µä¸‹ï¼Œå°†å†…å®¹è½¬æ¢ä¸ºæ›´å…·ç¤¾äº¤åª’ä½“ä¼ æ’­åŠ›çš„ç‰ˆæœ¬ã€‚è¦æ±‚ï¼š
- è½»æ¾ã€æœ‰è¶£ã€å¸å¼•çœ¼çƒï¼›
- æ›´é€‚åˆçŸ­ä¼ æ’­åœºæ™¯ï¼›
- ä¿ç•™åŸæœ¬æ ¸å¿ƒä¿¡æ¯ã€‚
    `,

    technical: `
ä½ æ˜¯ä¸€ä½æŠ€æœ¯æ–‡æ¡£æ’°å†™ä¸“å®¶ã€‚è¯·åœ¨ä¿æŒè¾“å…¥è¯­è¨€ä¸å˜ï¼ˆè¾“å…¥ä»€ä¹ˆè¯­è¨€ï¼Œå°±ç”¨ä»€ä¹ˆè¯­è¨€è¾“å‡ºï¼‰çš„æƒ…å†µä¸‹ï¼Œå°†å†…å®¹æ”¹å†™ä¸ºæŠ€æœ¯æ–‡æ¡£é£æ ¼ã€‚è¦æ±‚ï¼š
- ç²¾ç¡®æ¸…æ™°ã€ç»“æ„åŒ–ï¼›
- ç”¨è¯è§„èŒƒï¼Œé€»è¾‘ä¸¥å¯†ï¼›
- ä¸æ·»åŠ ä¸å­˜åœ¨çš„æŠ€æœ¯å†…å®¹ï¼Œåªæå‡è¡¨è¾¾ã€‚
    `
};

 function init() {
            // æ£€æŸ¥API Keyæ˜¯å¦å·²è®¾ç½®
            if (API_KEY === 'åœ¨è¿™é‡Œç²˜è´´ä½ çš„API Key' || !API_KEY) {
                showError('âš ï¸ è¯·åœ¨ä»£ç ä¸­è®¾ç½®API Keyï¼æ‰¾åˆ°ä»£ç ç¬¬243è¡Œçš„ API_KEY å˜é‡å¹¶å¡«å…¥ä½ çš„API Keyã€‚');
 }
            renderStyleButtons();
            loadHistory();
            updateCharCount();
 }

        function switchMode(mode) {
            currentMode = mode;
 document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-600');
            });
 document.getElementById(`tab-${mode}`).classList.add('tab-active');
            document.getElementById(`tab-${mode}`).classList.remove('text-gray-600');

            ['translateMode', 'critiqueMode', 'enhanceMode', 'compareMode'].forEach(m => {
                document.getElementById(m).classList.add('hidden');
            });
 document.getElementById(`${mode}Mode`).classList.remove('hidden');
        }

        function renderStyleButtons() {
            const container = document.getElementById('styleButtons');
 container.innerHTML = styles.map(style => `
                <button 
                    onclick="selectStyle('${style.id}')"
                    id="style-${style.id}"
                    class="p-4 rounded-lg border-2 transition-all ${selectedStyle === style.id ? 'border-indigo-600 bg-indigo-50 shadow-md' : 'border-gray-200 hover:border-indigo-300'}"
      
                      >
                    <div class="text-3xl mb-2">${style.icon}</div>
                    <h3 class="font-semibold text-gray-800">${style.name}</h3>
                    <p class="text-xs text-gray-500 mt-1">${style.desc}</p>
                </button>
       
           `).join('');
        }

        function selectStyle(styleId) {
            selectedStyle = styleId;
 renderStyleButtons();
        }

        function showError(message) {
            const errorBox = document.getElementById('errorBox');
 if (message) {
                errorBox.textContent = message;
 errorBox.classList.remove('hidden');
            } else {
                errorBox.classList.add('hidden');
 }
        }

        function updateCharCount() {
            const inputText = document.getElementById('inputText').value;
 const outputText = document.getElementById('outputText').textContent;
            document.getElementById('inputCount').textContent = `${inputText.length} å­—`;
            document.getElementById('outputCount').textContent = `${outputText.length} å­—`;
 }

        function updateCritiqueCount() {
            const text = document.getElementById('critiqueInput').value;
 document.getElementById('critiqueInputCount').textContent = `${text.length} å­—`;
        }
        // âœ¨ æ–°å¢ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(inputElement, targetTextareaId) {
            const file = inputElement.files[0];
            if (!file) return;

            // ... (è¿™é‡Œæ˜¯ä½ ç²˜è´´çš„å‡½æ•°çš„ä¸­é—´éƒ¨åˆ†) ...

            // å¤„ç†æ™®é€šæ–‡æœ¬æ–‡ä»¶ (.txt)
            else {
                reader.onload = function(e) {
                    textarea.value = e.target.result;
                    if (targetTextareaId === 'inputText') updateCharCount();
                    if (targetTextareaId === 'critiqueInput') updateCritiqueCount();
                    inputElement.value = '';
                    textarea.placeholder = originalPlaceholder;
                };
                reader.readAsText(file);
            }
        }
        // ğŸ‘†ğŸ‘†ğŸ‘† ç²˜è´´ç»“æŸ ğŸ‘†ğŸ‘†ğŸ‘†

        // è°ƒç”¨APIçš„é€šç”¨å‡½æ•°
        async function callZhipuAPI(messages, temperature = 0.5) {
            const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 
 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: API_MODEL,
                    messages: messages,
   
                     temperature: temperature,
                    max_tokens: 3000
                })
            });
 if (!response.ok) {
                const errorText = await response.text();
 throw new Error(`APIè¯·æ±‚å¤±è´¥ (${response.status}): ${errorText}`);
            }

            const data = await response.json();
 return data.choices?.[0]?.message?.content || 'âš ï¸ æ— è¿”å›å†…å®¹';
        }

        async function generateContent() {
            const inputText = document.getElementById('inputText').value.trim();
 if (!inputText) {
                showError('è¯·è¾“å…¥è¦è½¬æ¢çš„å†…å®¹');
                return;
 }

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
 generateBtn.innerHTML = '<span class="loading inline-block">âš™ï¸</span> ç”Ÿæˆä¸­...';
            showError('');

            try {
                const result = await callZhipuAPI([
                    { role: 'system', content: stylePrompts[selectedStyle] },
                    { role: 'user', content: inputText }
                ], styles.find(s => s.id === selectedStyle).temp);
 document.getElementById('outputText').innerHTML = `<p class="text-gray-800 whitespace-pre-wrap">${result}</p>`;
                document.getElementById('copyBtn').classList.remove('hidden');
                document.getElementById('downloadBtn').classList.remove('hidden');

                saveHistory(inputText, result, 'translate');
                updateCharCount();
 } catch (error) {
                showError(error.message || 'è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥API Keyæˆ–ç½‘ç»œè¿æ¥');
 } finally {
                generateBtn.disabled = false;
 generateBtn.innerHTML = 'âœ¨ ç”Ÿæˆå†…å®¹';
            }
        }

        async function critiqueText() {
            const inputText = document.getElementById('critiqueInput').value.trim();
 const critiqueType = document.getElementById('critiqueType').value;

            if (!inputText) {
                showError('è¯·è¾“å…¥éœ€è¦æ‰¹æ”¹çš„æ–‡æœ¬');
 return;
            }

            const critiqueBtn = document.getElementById('critiqueBtn');
            critiqueBtn.disabled = true;
 critiqueBtn.innerHTML = '<span class="loading inline-block">âš™ï¸</span> æ‰¹æ”¹ä¸­...';
            showError('');

            const typeDescriptions = {
                academic: 'å­¦æœ¯è®ºæ–‡ï¼ˆæ³¨é‡é€»è¾‘æ€§ã€åˆ›æ–°æ€§ã€å­¦æœ¯è§„èŒƒï¼‰',
                business: 'å•†åŠ¡æ–‡æ¡£ï¼ˆæ³¨é‡ä¸“ä¸šæ€§ã€ç®€æ´æ€§ã€è¯´æœåŠ›ï¼‰',
                creative: 'åˆ›æ„å†™ä½œï¼ˆæ³¨é‡è¡¨ç°åŠ›ã€ç‹¬ç‰¹æ€§ã€æ„ŸæŸ“åŠ›ï¼‰',
                technical: 'æŠ€æœ¯æ–‡æ¡£ï¼ˆæ³¨é‡å‡†ç¡®æ€§ã€ç»“æ„æ€§ã€å¯è¯»æ€§ï¼‰',
                general: 'é€šç”¨æ–‡æœ¬ï¼ˆæ³¨é‡è¯­æ³•ã€æµç•…æ€§ã€å¯ç†è§£æ€§ï¼‰'
     
            };

            try {
                const result = await callZhipuAPI([
                    { 
                        role: 'system', 
                        
 content: `ä½ æ˜¯ä¸€ä½èµ„æ·±æ–‡æœ¬æ‰¹æ”¹ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹${typeDescriptions[critiqueType]}è¿›è¡Œè¯¦ç»†æ‰¹æ”¹ã€‚

è¯·æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¿”å›è¯„åˆ†å’Œå»ºè®®ï¼ˆåªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼‰ï¼š
{
  "overall_score": 85,
  "scores": {
    "grammar": 90,
    "logic": 80,
    "clarity": 85,
    "style": 80,
    "innovation": 75
  },
  "issues": [
    {"type": "error", "line": "åŸæ–‡ç‰‡æ®µ", "problem": "é—®é¢˜æè¿°", "suggestion": "ä¿®æ”¹å»ºè®®"},
    {"type": "warning", "line": "åŸæ–‡ç‰‡æ®µ", "problem": "é—®é¢˜æè¿°", "suggestion": "ä¿®æ”¹å»ºè®®"}
  ],
  "summary": "æ€»ä½“è¯„ä»·å’Œæ”¹è¿›æ–¹å‘"
}` 
                    },
               
                     { role: 'user', content: inputText }
                ], 0.3);
 const cleanResult = result.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const critiqueData = JSON.parse(cleanResult);

                displayCritiqueResults(critiqueData);
                saveHistory(inputText, JSON.stringify(critiqueData), 'critique');
 } catch (error) {
                showError(error.message || 'æ‰¹æ”¹å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•');
 console.error(error);
            } finally {
                critiqueBtn.disabled = false;
 critiqueBtn.innerHTML = 'ğŸ“ å¼€å§‹æ‰¹æ”¹';
            }
        }

        function displayCritiqueResults(data) {
            const scorePanel = document.getElementById('scorePanel');
 const scoreLabels = {
                grammar: 'è¯­æ³•è§„èŒƒ',
                logic: 'é€»è¾‘æ€§',
                clarity: 'æ¸…æ™°åº¦',
                style: 'é£æ ¼',
                innovation: 'åˆ›æ–°æ€§'
            
 };

            let scoresHTML = `
                <div class="text-center mb-4">
                    <div class="text-4xl font-bold text-indigo-600">${data.overall_score ||
 0}</div>
                    <div class="text-sm text-gray-500">æ€»åˆ†</div>
                </div>
            `;
 if (data.scores) {
                scoresHTML += Object.entries(data.scores).map(([key, value]) => `
                    <div class="mb-3">
                        <div class="flex justify-between text-sm mb-1">
                            
 <span class="text-gray-700">${scoreLabels[key] || key}</span>
                            <span class="font-semibold text-gray-900">${value}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
               
                             <div class="score-bar bg-indigo-600 h-2 rounded-full" style="width: ${value}%"></div>
                        </div>
                    </div>
                `).join('');
 }

            scorePanel.innerHTML = scoresHTML;

            const resultsDiv = document.getElementById('critiqueResults');
 let issuesHTML = '';

            if (data.issues && data.issues.length > 0) {
                issuesHTML = data.issues.map((issue, idx) => `
                    <div class="border-l-4 ${issue.type === 'error' ? 'border-red-500 bg-red-50' : 'border-yellow-500 bg-yellow-50'} p-4 rounded">
                        <div class="flex items-start gap-2">
          
                           <span class="text-xl">${issue.type === 'error' ? 'âŒ' : 'âš ï¸'}</span>
                            <div class="flex-1">
                                <div class="font-medium text-gray-800">${issue.problem}</div>
            
                                 <div class="text-sm text-gray-600 mt-1">åŸæ–‡ï¼š<code class="bg-white px-2 py-1 rounded">${issue.line}</code></div>
                                <div class="text-sm text-green-700 mt-1">ğŸ’¡ å»ºè®®ï¼š${issue.suggestion}</div>
                            </div>
         
                        </div>
                    </div>
                `).join('');
 }

            if (data.summary) {
                issuesHTML += `
                    <div class="border-l-4 border-blue-500 bg-blue-50 p-4 rounded mt-4">
                        <div class="flex items-start gap-2">
               
                             <span class="text-xl">ğŸ“Š</span>
                            <div>
                                <div class="font-medium text-gray-800">æ€»ä½“è¯„ä»·</div>
                        
                                 <div class="text-sm text-gray-700 mt-1">${data.summary}</div>
                            </div>
                        </div>
                    </div>
                `;
 }

            resultsDiv.innerHTML = issuesHTML || '<p class="text-gray-400">æš‚æ— å…·ä½“é—®é¢˜</p>';
 }

        async function enhanceText() {
            const inputText = document.getElementById('enhanceInput').value.trim();
 if (!inputText) {
                showError('è¯·è¾“å…¥éœ€è¦ä¼˜åŒ–çš„æ–‡æœ¬');
                return;
 }

            const enhanceOptions = [];
            if (document.getElementById('enhance-clarity').checked) enhanceOptions.push('æå‡æ¸…æ™°åº¦');
 if (document.getElementById('enhance-concise').checked) enhanceOptions.push('ç®€æ´è¡¨è¾¾');
            if (document.getElementById('enhance-professional').checked) enhanceOptions.push('å¢å¼ºä¸“ä¸šæ€§');
            if (document.getElementById('enhance-engaging').checked) enhanceOptions.push('æå‡å¸å¼•åŠ›');

            const enhanceBtn = document.getElementById('enhanceBtn');
            enhanceBtn.disabled = true;
 enhanceBtn.innerHTML = '<span class="loading inline-block">âš™ï¸</span> ä¼˜åŒ–ä¸­...';
            showError('');

            try {
                const result = await callZhipuAPI([
                    { 
                        role: 'system', 
                        content: 
 `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–‡æœ¬ä¼˜åŒ–ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚ä¼˜åŒ–æ–‡æœ¬ï¼š${enhanceOptions.join('ã€')}ã€‚ä¿æŒåŸæ„ï¼Œåªè¾“å‡ºä¼˜åŒ–åçš„æ–‡æœ¬ã€‚` 
                    },
                    { role: 'user', content: inputText }
                ], 0.5);
 document.getElementById('enhanceOutput').innerHTML = `<p class="text-gray-800 whitespace-pre-wrap">${result}</p>`;
                document.getElementById('copyEnhancedBtn').classList.remove('hidden');

                saveHistory(inputText, result, 'enhance');
            } catch (error) {
                showError(error.message || 'ä¼˜åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•');
 } finally {
                enhanceBtn.disabled = false;
 enhanceBtn.innerHTML = 'âœ¨ å¼€å§‹ä¼˜åŒ–';
            }
        }

        async function compareVersions() {
            const textA = document.getElementById('compareTextA').value.trim();
 const textB = document.getElementById('compareTextB').value.trim();

            if (!textA || !textB) {
                showError('è¯·è¾“å…¥ä¸¤ä¸ªç‰ˆæœ¬çš„æ–‡æœ¬');
 return;
            }

            const compareBtn = document.getElementById('compareBtn');
            compareBtn.disabled = true;
 compareBtn.innerHTML = '<span class="loading inline-block">âš™ï¸</span> å¯¹æ¯”ä¸­...';
            showError('');

            try {
                const result = await callZhipuAPI([
                    { 
                        role: 'system', 
                        content: 
 `ä½ æ˜¯ä¸€ä½æ–‡æœ¬åˆ†æä¸“å®¶ã€‚è¯·å¯¹æ¯”ä»¥ä¸‹ä¸¤ä¸ªç‰ˆæœ¬çš„æ–‡æœ¬ï¼Œä»ä»¥ä¸‹ç»´åº¦åˆ†æï¼š
1. ä¸»è¦å·®å¼‚ç‚¹
2. å„è‡ªä¼˜åŠ¿
3. å„è‡ªä¸è¶³
4. æ¨èä½¿ç”¨åœºæ™¯
5. æ”¹è¿›å»ºè®®

è¯·ç”¨æ¸…æ™°çš„æ ¼å¼å±•ç¤ºå¯¹æ¯”ç»“æœã€‚` 
                    },
                    { role: 'user', content: `ç‰ˆæœ¬Aï¼š\n${textA}\n\nç‰ˆæœ¬Bï¼š\n${textB}` }
                ], 0.4);
 document.getElementById('compareResults').innerHTML = `<div class="text-gray-800 whitespace-pre-wrap">${result}</div>`;

                saveHistory(`å¯¹æ¯”ï¼š${textA.substring(0, 50)}... vs ${textB.substring(0, 50)}...`, result, 'compare');
 } catch (error) {
                showError(error.message || 'å¯¹æ¯”å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•');
 } finally {
                compareBtn.disabled = false;
 compareBtn.innerHTML = 'ğŸ”„ æ™ºèƒ½å¯¹æ¯”';
            }
        }

        function copyText() {
            const text = document.getElementById('outputText').textContent;
 navigator.clipboard.writeText(text).then(() => alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'));
        }

        function copyEnhanced() {
            const text = document.getElementById('enhanceOutput').textContent;
 navigator.clipboard.writeText(text).then(() => alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'));
        }

        function downloadText() {
            const text = document.getElementById('outputText').textContent;
 const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
 a.download = `writing_${selectedStyle}_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
 document.getElementById('outputText').innerHTML = '<p class="text-gray-400 italic">ç”Ÿæˆçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>';
            document.getElementById('copyBtn').classList.add('hidden');
            document.getElementById('downloadBtn').classList.add('hidden');
            updateCharCount();
        }

        function saveHistory(input, output, mode) {
            const item = { 
                id: Date.now(), 
                input: input.substring(0, 200), 
                output: output.substring(0, 200), 
        
                 mode,
                style: selectedStyle, 
                timestamp: new Date().toLocaleString('zh-CN') 
            };
 historyData = [item, ...historyData].slice(0, 20);
            localStorage.setItem('writingHistory', JSON.stringify(historyData));
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('writingHistory');
 if (saved) {
                historyData = JSON.parse(saved);
 renderHistory();
            }
        }

        function renderHistory() {
            if (historyData.length === 0) {
                document.getElementById('historySection').classList.add('hidden');
 return;
            }
            document.getElementById('historySection').classList.remove('hidden');
            const container = document.getElementById('historyList');
 const modeIcons = {
                translate: 'ğŸŒ',
                critique: 'ğŸ“',
                enhance: 'âœ¨',
                compare: 'ğŸ”„'
            };
 const modeNames = {
                translate: 'è·¨è¯­è¨€å†™ä½œ',
                critique: 'æ™ºèƒ½æ‰¹æ”¹',
                enhance: 'é£æ ¼ä¼˜åŒ–',
                compare: 'ç‰ˆæœ¬å¯¹æ¯”'
            };
 container.innerHTML = historyData.map(item => {
                const style = styles.find(s => s.id === item.style);
                return `
                    <div onclick='loadHistoryItem(${JSON.stringify(item).replace(/'/g, "&apos;")})'
                        class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
    
                         <div class="flex justify-between items-start mb-2">
                            <span class="text-sm font-medium text-indigo-600">
                                ${modeIcons[item.mode] || 'ğŸ“„'} ${modeNames[item.mode] || item.mode}
        
                             </span>
                            <span class="text-xs text-gray-500">${item.timestamp}</span>
                        </div>
                        <p class="text-sm 
 text-gray-600 truncate">${item.input}</p>
                    </div>`;
            }).join('');
 }

        function loadHistoryItem(item) {
            switchMode(item.mode);
 if (item.mode === 'translate') {
                document.getElementById('inputText').value = item.input;
 document.getElementById('outputText').innerHTML = `<p class="text-gray-800 whitespace-pre-wrap">${item.output}</p>`;
                selectedStyle = item.style;
                renderStyleButtons();
                document.getElementById('copyBtn').classList.remove('hidden');
                document.getElementById('downloadBtn').classList.remove('hidden');
                updateCharCount();
 } else if (item.mode === 'critique') {
                document.getElementById('critiqueInput').value = item.input;
 try {
                    const critiqueData = JSON.parse(item.output);
 displayCritiqueResults(critiqueData);
                } catch (e) {
                    document.getElementById('critiqueResults').innerHTML = `<p class="text-gray-800">${item.output}</p>`;
 }
            } else if (item.mode === 'enhance') {
                document.getElementById('enhanceInput').value = item.input;
 document.getElementById('enhanceOutput').innerHTML = `<p class="text-gray-800 whitespace-pre-wrap">${item.output}</p>`;
                document.getElementById('copyEnhancedBtn').classList.remove('hidden');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
 }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                historyData = [];
 localStorage.removeItem('writingHistory');
                renderHistory();
            }
        }

        window.onload = init;
 </script>
</body>
</html>